<!DOCTYPE html>
<html>
<head>
  <title>CVO Music Player</title>
  <style>
    /* Styling for the button and input field */
    button, input {
      padding: 8px;
      margin: 5px;
      font-size: 16px;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    input {
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    /* Container for iframes */
    .iframe-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px; /* Space between iframes */
    }
    /* Individual iframe style */
    iframe {
      width: calc(25% - 10px); /* Adjusted width for 4 iframes in a row with a gap of 10px */
      height: 315px;
      margin: 0;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

<div>
  <input type="number" id="endTimeInput" placeholder="End time (seconds)" value="30" />
  <button onclick="setEndTimes()">Set End Time</button>
  <button onclick="shuffleIframes()">Shuffle Songs</button>
  <button onclick="downloadTitles()">Download Song List</button>
</div>

 <!-- Add more iframe elements for each genre here (the order matters!)-->
<div class="iframe-container">
    <!-- HIP HOP: -->
    <iframe width="560" height="315" src="https://www.youtube.com/embed/9FMBppbFl8E?si=i13slY_mJfzRuXo6&amp;start=113" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/CNhDRx08wEw?si=Iw7CFH5EvD2Uv3Dp&amp;start=5" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/b5uLsEYq_SM?si=mLnH3WCaLGeXqWBn&amp;start=71" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/At2dQTVDp24?si=1FoCVtfSqd_fy0MZ&amp;start=93" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <!-- CLASSIC: -->
    <iframe width="560" height="315" src="https://www.youtube.com/embed/mFWQgxXM_b8?si=i-slZOCZF9bZYhWD&amp;start=80" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/8k41D9por6c?si=J3JAszZNXkNs-mL9&amp;start=453" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/rP42C-4zL3w?si=TM_VUdp4PMOFMJ6h&amp;start=728" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/YOw2Fov26q8?si=QsjjtKJ8fBXNBh7h&amp;start=878" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <!-- ROCK: -->
    <iframe width="560" height="315" src="https://www.youtube.com/embed/QECEwSqOaGM?si=3v9PZakwNo90ur4X&amp;start=62" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/oYNPlzR5PWY?si=ESvwEnfpLTWCbhyt&amp;start=100" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/Xn2iBcHgeok?si=P1-FiBr2uUVKAiPO&amp;start=151" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/N6EXUBF03MA?si=huitMLaEcq0TUK_h&amp;start=116" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <!-- JAZZ: -->
    <iframe width="560" height="315" src="https://www.youtube.com/embed/D6mFGy4g_n8?si=Z5I6DWWA0r9x_JoL&amp;start=78" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/qNSxiLnJSVQ?si=QHYgTA4zjqgpAQWV&amp;start=64" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/0Ue9igC7flI?si=7DzLkuTSc2AxxteM&amp;start=86" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/xu7UP4wdn7I?si=07hD1_OsNx2rinhf&amp;start=49" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <!-- COUNTRY: -->
    <iframe width="560" height="315" src="https://www.youtube.com/embed/3iuFH2tEzhQ?si=6gWIogU1kM0kHRAI&amp;start=82" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/22qeAi7qRXg?si=azXlPhtqnvwp6E7D&amp;start=136" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/fQV_S_RJOXs?si=vmOTs-pY_JNur5wA&amp;start=82" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/evlJQWm39gQ?si=sBw7enDycg4rEYcE&amp;start=104" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    
<script>
var genres = ['HIP HOP', 'HIP HOP', 'HIP HOP', 'HIP HOP', 
              'CLASSIC', 'CLASSIC', 'CLASSIC', 'CLASSIC',
              'ROCK','ROCK','ROCK','ROCK',
              'JAZZ', 'JAZZ', 'JAZZ', 'JAZZ', 
              'COUNTRY', 'COUNTRY', 'COUNTRY', 'COUNTRY'];

function setEndTimes() {
  var endTime = document.getElementById('endTimeInput').value;
  var iframes = document.querySelectorAll('.iframe-container iframe');

  iframes.forEach(function(iframe) {
    var url = new URL(iframe.src);
    var startTime = parseInt(url.searchParams.get('start'));
    var endTimeValue = parseInt(endTime);
    
    if (!isNaN(endTimeValue)) {
      var calculatedEndTime = startTime + endTimeValue;
      url.searchParams.set('end', calculatedEndTime);
      iframe.src = url.href;
    }
  });
}

async function shuffleIframes() {
  var iframes = document.querySelectorAll('.iframe-container iframe');
  var iframeArray = Array.from(iframes);

  saveToFile.blobParts = [];

  // Fisher-Yates shuffle algorithm
  for (var i = iframeArray.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var temp = iframeArray[i];
    iframeArray[i] = iframeArray[j];
    iframeArray[j] = temp;

    // Shuffle genres in the same way
    var tempGenre = genres[i];
    genres[i] = genres[j];
    genres[j] = tempGenre;
  }

  // Reorder iframes in the document
  var parent = document.querySelector('.iframe-container');
  for (const [index, iframe] of iframeArray.entries()) {
    parent.appendChild(iframe);
    await fetchTitle(iframe, index + 1);
  }
}

async function fetchTitle(iframe, index) {
  try {
    const response = await fetch(`https://noembed.com/embed?url=${iframe.src}`);
    const data = await response.json();
    song_str = `[${genres[index-1]}] - Song ${index}: ${data.title}`;
    console.log(song_str);
    saveToFile(song_str); // Save fetched title to local file
  } catch (error) {
    console.error('Error fetching title:', error);
  }
}

// Function to save titles to a local file
function saveToFile(title) {
  if (!saveToFile.blobParts) {
    saveToFile.blobParts = [];
  }

  const blob = new Blob([title + '\n'], { type: 'text/plain' });
  saveToFile.blobParts.push(blob);
}

// Function to trigger file download
function downloadTitles() {
  const blob = new Blob(saveToFile.blobParts, { type: 'text/plain' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  const timestamp = new Date().toLocaleString().replace(/[\/.,]/g, '-').replace(/ /g, '_').replace(/:/g, '-');
  const fileName = `song_list_${timestamp}.txt`;
  a.download = fileName;
  a.click();
  window.URL.revokeObjectURL(url);
}


window.onload = async function() {
  setEndTimes();
  var iframes = document.querySelectorAll('.iframe-container iframe');
  for (const [index, iframe] of Array.from(iframes).entries()) {
    await fetchTitle(iframe, index + 1);
  }
  
};
</script>

</body>
</html>
